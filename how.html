<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Write a benchmark &#8212; benchopt 1.4.1.dev10 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/style.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Publish benchmark results" href="publish.html" />
    <link rel="prev" title="benchopt.utils.profile" href="generated/benchopt.utils.profile.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          benchopt</a>
        <span class="navbar-text navbar-version pull-left"><b>1.4.1.dev10</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="cli.html">CLI</a></li>
                <li><a href="api.html">API</a></li>
                <li><a href="https://benchopt.github.io/results">Results</a></li>
                <li><a href="whats_new.html">What's new</a></li>
                <li><a href="https://github.com/benchopt/benchopt">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Write a benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="publish.html">Publish benchmark results</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">BenchOpt configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced functionalities in a benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="whats_new.html">What’s new</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/benchopt/benchopt">Fork benchopt on Github</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Write a benchmark</a><ul>
<li><a class="reference internal" href="#objective">1. Objective</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#datasets">2. Datasets</a><ul>
<li><a class="reference internal" href="#example-using-a-real-dataset">Example using a real dataset</a></li>
<li><a class="reference internal" href="#example-of-parametrized-simulated-dataset">Example of parametrized simulated dataset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solvers">3. Solvers</a><ul>
<li><a class="reference internal" href="#python-solver">Python solver</a></li>
<li><a class="reference internal" href="#r-solver">R solver</a></li>
<li><a class="reference internal" href="#julia-solver">Julia solver</a></li>
<li><a class="reference internal" href="#solver-from-source">Solver from source</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <section id="write-a-benchmark">
<span id="how"></span><h1>Write a benchmark<a class="headerlink" href="#write-a-benchmark" title="Permalink to this headline">¶</a></h1>
<p>A benchmark is composed of three elements: an <a class="reference internal" href="#objective">objective</a> function,
a list of <a class="reference internal" href="#datasets">datasets</a>, and a list of <a class="reference internal" href="#solvers">solvers</a>.</p>
<p>A benchmark is defined in a folder that should respect a certain
structure. For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>my_benchmark/
├── objective.py  # contains the definition of the objective
├── datasets/
│   ├── simulated.py  # some dataset
│   └── real.py  # some dataset
└── solvers/
    ├── solver1.py  # some solver
    └── solver2.py  # some solver
</pre></div>
</div>
<p>Examples of actual benchmarks are available in the
<a class="reference external" href="https://github.com/benchopt/">benchopt organisation</a> such
as for <a class="reference external" href="https://github.com/benchopt/benchmark_ols">Ordinary Least Square (OLS)</a>,
<a class="reference external" href="https://github.com/benchopt/benchmark_lasso">Lasso</a> or
<a class="reference external" href="https://github.com/benchopt/benchmark_logreg_l1">L1-regularized logistic regression</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The simplest way to create a benchmark is to copy an existing folder and
to adapt its content.
A benchmark template is provided as a <a class="reference external" href="https://github.com/benchopt/template_benchmark">GitHub template repo here</a></p>
</div>
<section id="objective">
<span id="id1"></span><h2>1. Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>The <strong>objective function</strong> is defined through a Python class.
This class allows to monitor the quantities of interest along the iterations
of the solvers. Typically it allows to evaluate the objective function to
be minimized by the solvers. An objective class should define 3 methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_one_solution()</span></code>: it returns one solution that can be returned by a solver.
This defines the shape of the solution and will be used to test that the
benchmark works properly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_data(**data)</span></code>: it allows to specify the data. See the data as a dictionary
of Python variables without any constraint.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compute(x)</span></code>: it allows to evaluate the objective for a given value
of the iterate, here called <code class="docutils literal notranslate"><span class="pre">x</span></code>. This method should take only one parameter,
the output returned by the solver. All other parameters should be stored
in the class with the <code class="docutils literal notranslate"><span class="pre">set_data</span></code> method. The <code class="docutils literal notranslate"><span class="pre">compute</span></code> function should return
a float (understood as the objective value) or a dictionary. If a dictionary
is returned it should contain a key called <code class="docutils literal notranslate"><span class="pre">value</span></code> (the objective value) and all other keys
should have <code class="docutils literal notranslate"><span class="pre">float</span></code> values allowing to track more than one value
of interest (e.g. train and test errors).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_objective()</span></code>: method that returns a dictionary to be passed
to the <code class="docutils literal notranslate"><span class="pre">set_objective</span></code> methods of <a class="reference internal" href="#solvers">solvers</a>.</p></li>
</ul>
<p>An objective class also needs to inherit from a base class,
<a class="reference internal" href="generated/benchopt.BaseObjective.html#benchopt.BaseObjective" title="benchopt.BaseObjective"><code class="xref py py-class docutils literal notranslate"><span class="pre">benchopt.BaseObjective</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multiple values can be computed in one objective as long as they are
stored in a dictionary with a key being <code class="docutils literal notranslate"><span class="pre">value</span></code>. This allows to compute
different metrics at once.</p>
</div>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">benchopt.base</span> <span class="kn">import</span> <span class="n">BaseObjective</span><span class="p">,</span> <span class="n">safe_import_context</span>

<span class="c1"># All packages other than benchopt should be imported in this context.</span>
<span class="c1"># - This allows to list solvers even when a package is not installed,</span>
<span class="c1">#   in particular for listing dependencies to install.</span>
<span class="c1"># - This allows to skip imports when listing solvers and datasets</span>
<span class="c1">#   for auto completion.</span>
<span class="k">with</span> <span class="n">safe_import_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">import_ctx</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">BaseObjective</span><span class="p">):</span>
    <span class="c1"># Name of the Objective function</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Lasso Regression&quot;</span>

    <span class="c1"># parametrization of the objective with various regularization parameters.</span>
    <span class="c1"># All parameters `p` defined here will be accessible as `self.p`.</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;reg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.5</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_one_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Return one solution for which the objective can be evaluated.&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_get_lambda_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Helper to compute the scaling of lambda on the given data.&quot;</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the data from a Dataset to compute the objective.</span>

<span class="sd">        The argument are the keys in the data dictionary returned by</span>
<span class="sd">        get_data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lambda_max</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="s2">&quot;Compute the objective value given the output x of a solver.&quot;</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">@</span> <span class="n">beta</span>
        <span class="n">objective_value</span> <span class="o">=</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">diff</span> <span class="o">@</span> <span class="n">diff</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">objective_value</span>  <span class="c1"># or return dict(value=objective_value)</span>

    <span class="k">def</span> <span class="nf">get_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns a dict to pass to the set_objective method of a solver.&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="datasets">
<span id="id2"></span><h2>2. Datasets<a class="headerlink" href="#datasets" title="Permalink to this headline">¶</a></h2>
<p>A dataset defines what can be passed to an objective. More specifically,
a dataset should implement one method:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_data()</span></code>: A method which outputs a dictionary that can be passed as
keyword arguments <code class="docutils literal notranslate"><span class="pre">**data</span></code> to the <code class="docutils literal notranslate"><span class="pre">set_data</span></code> method of an <a class="reference internal" href="#objective">objective</a>.</p></li>
</ul>
<p>A dataset class also needs to inherit from a base class called
<a class="reference internal" href="generated/benchopt.BaseDataset.html#benchopt.BaseDataset" title="benchopt.BaseDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">benchopt.BaseDataset</span></code></a>.</p>
<section id="example-using-a-real-dataset">
<h3>Example using a real dataset<a class="headerlink" href="#example-using-a-real-dataset" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">BaseDataset</span>

<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">safe_import_context</span>


<span class="k">with</span> <span class="n">safe_import_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">import_ctx</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_openml</span>
    <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelBinarizer</span>


<span class="k">class</span> <span class="nc">Dataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;leukemia&quot;</span>

    <span class="n">install_cmd</span> <span class="o">=</span> <span class="s1">&#39;conda&#39;</span>
    <span class="n">requirements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scikit-learn&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Unlike libsvm[leukemia], this dataset corresponds to the whole</span>
        <span class="c1"># leukemia  data with train + test data (72 samples) and not just</span>
        <span class="c1"># the training set.</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="s2">&quot;leukemia&quot;</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">LabelBinarizer</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also define a parametrized simulated dataset, for example to test
across multiple problem dimensions.</p>
</section>
<section id="example-of-parametrized-simulated-dataset">
<h3>Example of parametrized simulated dataset<a class="headerlink" href="#example-of-parametrized-simulated-dataset" title="Permalink to this headline">¶</a></h3>
<p>Sometimes one wants to test the solvers for variants of the same dataset.
For example, one may want to change the dataset size, the noise level, etc.
To be able to specify parameters to get a dataset, you can use a class
attribute called <code class="docutils literal notranslate"><span class="pre">parameters</span></code>. This parameter must be a dictionary
whose keys are passed to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> of the dataset class. Then Benchopt
will automatically allow you to test all combinations of parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">BaseDataset</span>
<span class="kn">from</span> <span class="nn">benchopt.datasets</span> <span class="kn">import</span> <span class="n">make_correlated_data</span>


<span class="k">class</span> <span class="nc">Dataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Simulated&quot;</span>
    <span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>

    <span class="c1"># List of parameters to generate the datasets. The benchmark will consider</span>
    <span class="c1"># the cross product for each key in the dictionary.</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;n_samples, n_features&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="n">rho</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">27</span><span class="p">):</span>
        <span class="c1"># Store the parameters of the dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_correlated_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">,</span>
                                       <span class="n">rho</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>However, all of these variants will not be tested during the call to <code class="docutils literal notranslate"><span class="pre">benchopt</span> <span class="pre">test</span></code>.
If you want to test different variants of the simulated dataset with <code class="docutils literal notranslate"><span class="pre">benchopt</span> <span class="pre">test</span></code>,
you may use the <code class="docutils literal notranslate"><span class="pre">test_parameters</span></code> class attribute.
The construction of this attribute is similar to the one described above for
<code class="docutils literal notranslate"><span class="pre">parameters</span></code>. This allows you to test solvers that could not be used for a single
variant of the dataset.</p>
</section>
</section>
<section id="solvers">
<span id="id3"></span><h2>3. Solvers<a class="headerlink" href="#solvers" title="Permalink to this headline">¶</a></h2>
<p>A solver must define three methods:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set_objective(**objective_dict)</span></code>: This method will be called with the
dictionary <code class="docutils literal notranslate"><span class="pre">objective_dict</span></code> returned by the method <code class="docutils literal notranslate"><span class="pre">get_objective</span></code>
from the objective. The goal of this method is to provide all necessary
information to the solver so it can optimize the objective function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run(stop_value)</span></code>: This method takes only one parameter that controls the stopping
condition of the solver. Typically this is either a number of iterations <code class="docutils literal notranslate"><span class="pre">n_iter</span></code>
or a tolerance parameter <code class="docutils literal notranslate"><span class="pre">tol</span></code>. Alternatively, a <code class="docutils literal notranslate"><span class="pre">callback</span></code> function that will be
called at each iteration can be passed. The callback should return <code class="docutils literal notranslate"><span class="pre">False</span></code> once the
computation should stop.
The parameter <code class="docutils literal notranslate"><span class="pre">stop_value</span></code> is controlled by the <code class="docutils literal notranslate"><span class="pre">sampling_strategy</span></code>,
see below for details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_result()</span></code>: This method returns a variable that can be passed
to the <code class="docutils literal notranslate"><span class="pre">compute</span></code> method from the objective. This is the output of
the solver.</p></li>
</ul>
</div></blockquote>
<p><strong>Stop strategy:</strong></p>
<p>A solver should also define a <code class="docutils literal notranslate"><span class="pre">sampling_strategy</span></code> as class attribute.
This <code class="docutils literal notranslate"><span class="pre">sampling_strategy</span></code> can be:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'iteration'</span></code>: in this case the <code class="docutils literal notranslate"><span class="pre">run</span></code> method of the solver
is parametrized by the number of iterations computed. The parameter
is called <code class="docutils literal notranslate"><span class="pre">n_iter</span></code> and should be an integer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'tolerance'</span></code>: in this case the <code class="docutils literal notranslate"><span class="pre">run</span></code> method of the solver
is parametrized by a tolerance that should decrease with
the running time. The parameter is called <code class="docutils literal notranslate"><span class="pre">tol</span></code> and should be
a positive float.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'callback'</span></code>: in this case, the <code class="docutils literal notranslate"><span class="pre">run</span></code> method of the solver
should call at each iteration the provided callback function. It will
compute and store the objective and return <code class="docutils literal notranslate"><span class="pre">False</span></code> once the computations
should stop.</p></li>
</ul>
</div></blockquote>
<p>Benchopt supports different types of solvers:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#python-solvers"><span class="std std-ref">Python solver</span></a></p></li>
<li><p><a class="reference internal" href="#r-solvers"><span class="std std-ref">R solver</span></a></p></li>
<li><p><a class="reference internal" href="#julia-solvers"><span class="std std-ref">Julia solver</span></a></p></li>
<li><p><a class="reference internal" href="#source-solvers"><span class="std std-ref">Solver from source</span></a></p></li>
</ul>
</div></blockquote>
<section id="python-solver">
<span id="python-solvers"></span><h3>Python solver<a class="headerlink" href="#python-solver" title="Permalink to this headline">¶</a></h3>
<p>The simplest solvers to use are solvers written in pure
<a class="reference external" href="https://www.python.org/">Python</a> without any compiled
code. They are typically written in <a class="reference external" href="https://numpy.org/">Numpy</a>
with no other dependencies. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">BaseSolver</span><span class="p">,</span> <span class="n">safe_import_context</span>
<span class="kn">from</span> <span class="nn">benchopt.utils</span> <span class="kn">import</span> <span class="n">profile</span>

<span class="k">with</span> <span class="n">safe_import_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">import_ctx</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">BaseSolver</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Python-PGD&#39;</span>  <span class="c1"># proximal gradient, optionally accelerated</span>

    <span class="c1"># Any parameter defined here is accessible as an attribute of the solver.</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;step_size&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]}</span>

    <span class="c1"># Store the information to compute the objective. The parameters of this</span>
    <span class="c1"># function are the keys of the dictionary obtained when calling</span>
    <span class="c1"># ``Objective.get_objective``.</span>
    <span class="k">def</span> <span class="nf">set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span>

    <span class="c1"># Main function of the solver, which compute a solution estimate.</span>
    <span class="c1"># Here this is the proximal gradient descent.</span>
    <span class="nd">@profile</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">step_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_size</span> <span class="o">/</span> <span class="n">L</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">step_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span>

        <span class="n">n_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_features</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">-=</span> <span class="n">step_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">@</span> <span class="n">w</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span>

    <span class="c1"># Return the solution estimate computed.</span>
    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
</pre></div>
</div>
<p>For solvers that allow access to each iterate of the solution, using <code class="docutils literal notranslate"><span class="pre">&quot;callback&quot;</span></code>
as a <code class="docutils literal notranslate"><span class="pre">sampling_strategy</span></code> implies a slight modification for <code class="docutils literal notranslate"><span class="pre">run</span></code>. A <code class="docutils literal notranslate"><span class="pre">callback</span></code>
should be called at each iteration with parameter the current value of the iterate.
Here is an example in the same situation as above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>  <span class="c1"># instead of the number of iteration or tolerance</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_lipschitz_cst</span><span class="p">()</span>
        <span class="n">n_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_features</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_acceleration</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_features</span><span class="p">)</span>

        <span class="n">t_new</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">callback</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_acceleration</span><span class="p">:</span>
                <span class="n">t_old</span> <span class="o">=</span> <span class="n">t_new</span>
                <span class="n">t_new</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">t_old</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">w_old</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">z</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">@</span> <span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="p">(</span><span class="n">t_old</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="n">t_new</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">w_old</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">@</span> <span class="n">w</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span>
</pre></div>
</div>
<p>If your Python solver requires some packages such as <a class="reference external" href="https://numba.pydata.org/">Numba</a>,
Benchopt allows you to list some requirements. The necessary packages should be available
via <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a> or
<a class="reference external" href="https://packaging.python.org/guides/tool-recommendations/">pip</a>.</p>
<p>In this case the <code class="docutils literal notranslate"><span class="pre">install_cmd</span></code> class variable needs to be set to <code class="docutils literal notranslate"><span class="pre">'conda'</span></code>
and the list of needed packages is specified in the variable
<code class="docutils literal notranslate"><span class="pre">requirements</span></code> that needs to be a Python list. If a requirement
starts with <code class="docutils literal notranslate"><span class="pre">pip:</span></code> then the package is installed from <a class="reference external" href="https://pypi.org/">pypi</a> and
not <a class="reference external" href="https://conda-forge.org/">conda-forge</a>. See example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">BaseSolver</span>
<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">safe_import_context</span>


<span class="k">with</span> <span class="n">safe_import_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">import_ctx</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
    <span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>


<span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">BaseSolver</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sklearn&#39;</span>

    <span class="n">install_cmd</span> <span class="o">=</span> <span class="s1">&#39;conda&#39;</span>
    <span class="n">requirements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scikit-learn&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span>

        <span class="n">n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span><span class="o">/</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">ConvergenceWarning</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">install_cmd</span></code> can either be <code class="docutils literal notranslate"><span class="pre">'conda'</span></code> or <code class="docutils literal notranslate"><span class="pre">'shell'</span></code>. If <code class="docutils literal notranslate"><span class="pre">'shell'</span></code>
a shell script is necessary to explain how to setup the required
dependencies. See <a class="reference internal" href="#source-solvers"><span class="std std-ref">Solver from source</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Specifying the dependencies is necessary if you let benchopt
manage the creation of a dedicated environment. If you want to
use your local environment the list of dependencies is
not relevant. See <a class="reference internal" href="cli.html#cli-documentation"><span class="std std-ref">Command line interface (CLI)</span></a>.</p>
</div>
</section>
<section id="r-solver">
<span id="r-solvers"></span><h3>R solver<a class="headerlink" href="#r-solver" title="Permalink to this headline">¶</a></h3>
<p>A solver written in <a class="reference external" href="https://www.r-project.org/">R</a> needs two files.
A <code class="docutils literal notranslate"><span class="pre">.R</span></code> file that contains the solver and a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file that knows how to call the
R solver using <a class="reference external" href="https://pypi.org/project/rpy2/">Rpy2</a>. Only the extensions
should differ between the two files. Here is the Python file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">BaseSolver</span>
<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">safe_import_context</span>

<span class="k">with</span> <span class="n">safe_import_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">import_ctx</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="kn">from</span> <span class="nn">rpy2</span> <span class="kn">import</span> <span class="n">robjects</span>
    <span class="kn">from</span> <span class="nn">rpy2.robjects</span> <span class="kn">import</span> <span class="n">numpy2ri</span>
    <span class="kn">from</span> <span class="nn">benchopt.helpers.r_lang</span> <span class="kn">import</span> <span class="n">import_func_from_r_file</span>

    <span class="c1"># Setup the system to allow rpy2 running</span>
    <span class="n">R_FILE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.R&#39;</span><span class="p">))</span>
    <span class="n">import_func_from_r_file</span><span class="p">(</span><span class="n">R_FILE</span><span class="p">)</span>
    <span class="n">numpy2ri</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">BaseSolver</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;R-PGD&quot;</span>

    <span class="n">install_cmd</span> <span class="o">=</span> <span class="s1">&#39;conda&#39;</span>
    <span class="n">requirements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r-base&#39;</span><span class="p">,</span> <span class="s1">&#39;rpy2&#39;</span><span class="p">]</span>
    <span class="n">stopping_strategy</span> <span class="o">=</span> <span class="s1">&#39;iteration&#39;</span>
    <span class="n">support_sparse</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">references</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;I. Daubechies, M. Defrise and C. De Mol, &#39;</span>
        <span class="s1">&#39;&quot;An iterative thresholding algorithm for linear inverse problems &#39;</span>
        <span class="s1">&#39;with a sparsity constraint&quot;, Comm. Pure Appl. Math., &#39;</span>
        <span class="s1">&#39;vol. 57, pp. 1413-1457, no. 11, Wiley Online Library (2004)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;A. Beck and M. Teboulle, &quot;A fast iterative shrinkage-thresholding &#39;</span>
        <span class="s1">&#39;algorithm for linear inverse problems&quot;, SIAM J. Imaging Sci., &#39;</span>
        <span class="s1">&#39;vol. 2, no. 1, pp. 183-202 (2009)&#39;</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fit_intercept</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not handle fit_intercept&quot;</span>

        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_intercept</span> <span class="o">=</span> <span class="n">fit_intercept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_pgd</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;proximal_gradient_descent&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">):</span>
        <span class="n">coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_pgd</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span><span class="p">,</span>
            <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">)</span>
        <span class="n">as_r</span> <span class="o">=</span> <span class="n">robjects</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;as&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">as_r</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="s2">&quot;vector&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
<p>It uses the R code in:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">##&#39; Functions used in ISTA algorithm</span>
<span class="c1">##&#39;</span>
<span class="c1">##&#39; @title Functions used in ISTA algorithm</span>
<span class="c1">##&#39; @author Thomas Moreau</span>
<span class="c1">##&#39; @export</span>


<span class="c1"># Soft-thresholding operator</span>
<span class="n">St</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">lambda0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lambda0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">result0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lambda0</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lambda0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">result0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lambda0</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="n">result0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>

<span class="w">        </span><span class="nf">return</span><span class="p">(</span><span class="n">result0</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">lambda0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="p">)</span>
<span class="w">    </span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span>


<span class="c1"># Main algorithm</span>
<span class="n">proximal_gradient_descent</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">n_iter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># --------- Initialize parameter ---------</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncol</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="w">    </span><span class="n">parameters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">numeric</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">    </span><span class="n">step_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">norm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="m">2</span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n_iter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Compute the gradient</span>
<span class="w">        </span><span class="n">grad</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">crossprod</span><span class="p">(</span><span class="o">-</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">parameters</span><span class="p">))</span>
<span class="w">        </span><span class="c1"># # Update the parameters</span>
<span class="w">        </span><span class="n">parameters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">St</span><span class="p">(</span><span class="n">step_size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">step_size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">grad</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nf">return</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This uses the function <a class="reference internal" href="generated/benchopt.safe_import_context.html#benchopt.safe_import_context" title="benchopt.safe_import_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">benchopt.safe_import_context()</span></code></a> to avoid
a crash when R is not available. The solver is in this case
just skipped.</p>
</div>
</section>
<section id="julia-solver">
<span id="julia-solvers"></span><h3>Julia solver<a class="headerlink" href="#julia-solver" title="Permalink to this headline">¶</a></h3>
<p>A solver written in <a class="reference external" href="https://julialang.org">Julia</a> needs two files.
A <code class="docutils literal notranslate"><span class="pre">.jl</span></code> file that contains the solver and a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file that knows how to call the
Julia solver using <a class="reference external" href="https://pypi.org/project/julia/">PyJulia</a>. Only the extensions
should differ between the two files. Here is the Python file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">safe_import_context</span>

<span class="kn">from</span> <span class="nn">benchopt.helpers.julia</span> <span class="kn">import</span> <span class="n">JuliaSolver</span>
<span class="kn">from</span> <span class="nn">benchopt.helpers.julia</span> <span class="kn">import</span> <span class="n">get_jl_interpreter</span>
<span class="kn">from</span> <span class="nn">benchopt.helpers.julia</span> <span class="kn">import</span> <span class="n">assert_julia_installed</span>

<span class="k">with</span> <span class="n">safe_import_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">import_ctx</span><span class="p">:</span>
    <span class="n">assert_julia_installed</span><span class="p">()</span>


<span class="c1"># File containing the function to be called from julia</span>
<span class="n">JULIA_SOLVER_FILE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s1">&#39;.jl&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">JuliaSolver</span><span class="p">):</span>

    <span class="c1"># Config of the solver</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Julia-PGD&#39;</span>
    <span class="n">stopping_strategy</span> <span class="o">=</span> <span class="s1">&#39;iteration&#39;</span>
    <span class="n">references</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;I. Daubechies, M. Defrise and C. De Mol, &#39;</span>
        <span class="s1">&#39;&quot;An iterative thresholding algorithm for linear inverse problems &#39;</span>
        <span class="s1">&#39;with a sparsity constraint&quot;, Comm. Pure Appl. Math., &#39;</span>
        <span class="s1">&#39;vol. 57, pp. 1413-1457, no. 11, Wiley Online Library (2004)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;A. Beck and M. Teboulle, &quot;A fast iterative shrinkage-thresholding &#39;</span>
        <span class="s1">&#39;algorithm for linear inverse problems&quot;, SIAM J. Imaging Sci., &#39;</span>
        <span class="s1">&#39;vol. 2, no. 1, pp. 183-202 (2009)&#39;</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="p">):</span>
        <span class="c1"># XXX - fit intercept is not yet implemented in julia.jl</span>
        <span class="k">if</span> <span class="n">fit_intercept</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not handle fit_intercept&quot;</span>

        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_intercept</span> <span class="o">=</span> <span class="n">fit_intercept</span>

        <span class="n">jl</span> <span class="o">=</span> <span class="n">get_jl_interpreter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve_lasso</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">JULIA_SOLVER_FILE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_lasso</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
<p>It uses the Julia code in:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Core</span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>

<span class="n">st</span><span class="p">(</span><span class="n">w</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span><span class="w"> </span><span class="n">t</span><span class="o">::</span><span class="kt">Float64</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@.</span><span class="w"> </span><span class="n">sign</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">)</span>

<span class="k">function</span><span class="w"> </span><span class="n">solve_lasso</span><span class="p">(</span>
<span class="w">    </span><span class="n">X</span><span class="o">::</span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span><span class="w"> </span>
<span class="w">    </span><span class="n">y</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span><span class="w"> </span>
<span class="w">    </span><span class="n">lambda</span><span class="o">::</span><span class="kt">Float64</span><span class="p">,</span>
<span class="w">    </span><span class="n">n_iter</span><span class="o">::</span><span class="kt">Int</span>
<span class="p">)</span>
<span class="w">    </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opnorm</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">    </span><span class="n">residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">similar</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">diffvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">similar</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="w">    </span><span class="n">gradient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">similar</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">                  </span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">∈</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n_iter</span>
<span class="w">        </span><span class="n">residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span>
<span class="w">        </span><span class="n">gradient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">residual</span>
<span class="w">        </span><span class="n">diffvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gradient</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">L</span>
<span class="w">        </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">(</span><span class="n">diffvec</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">L</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">w</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition-installing-julia-dependencies admonition">
<p class="admonition-title">Installing Julia dependencies</p>
<p>Note that it is also possible to install <code class="docutils literal notranslate"><span class="pre">julia</span></code> dependencies using <code class="docutils literal notranslate"><span class="pre">benchopt</span> <span class="pre">install</span></code> with the class attribute <code class="docutils literal notranslate"><span class="pre">julia_requirements</span></code>. This attribute should be a list of package names, whose string are directly passed to <code class="docutils literal notranslate"><span class="pre">Pkg.add</span></code>.</p>
<p>In case it is necessary to install dependencies from a GitHub repository, one can use the following format: <code class="docutils literal notranslate"><span class="pre">PkgName::https://github.com/org/Pkg.jl#branch_name</span></code>. This will be processed to recover both the url and the package name. Note that the <code class="docutils literal notranslate"><span class="pre">branch_name</span></code> is optional. Using the <code class="docutils literal notranslate"><span class="pre">::</span></code> to specify the <code class="docutils literal notranslate"><span class="pre">PkgName</span></code> is necessary to allow <code class="docutils literal notranslate"><span class="pre">benchopt</span></code> to check if it is installed in the targeted environment.</p>
</div>
</section>
<section id="solver-from-source">
<span id="source-solvers"></span><h3>Solver from source<a class="headerlink" href="#solver-from-source" title="Permalink to this headline">¶</a></h3>
<p>You can install a package from source in case it is not available
as binaries from the package managers from either Python, R or Julia.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A package available from source may require a C++
or Fortran compiler.</p>
</div>
<p>Here is example using pip from a Python package on GitHub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">BaseSolver</span>
<span class="kn">from</span> <span class="nn">benchopt</span> <span class="kn">import</span> <span class="n">safe_import_context</span>


<span class="k">with</span> <span class="n">safe_import_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">import_ctx</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
    <span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>


<span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">BaseSolver</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sklearn&#39;</span>

    <span class="n">install_cmd</span> <span class="o">=</span> <span class="s1">&#39;conda&#39;</span>
    <span class="n">requirements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scikit-learn&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lmbd</span>

        <span class="n">n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbd</span><span class="o">/</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">ConvergenceWarning</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See for example on the L1 logistic regression benchmark for
<a class="reference external" href="https://github.com/benchopt/benchmark_logreg_l1/blob/master/solvers/liblinear.py">an example</a>
that uses a <code class="docutils literal notranslate"><span class="pre">'shell'</span></code> as <code class="docutils literal notranslate"><span class="pre">install_cmd</span></code>.</p>
</div>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020-2022, Benchopt contributors.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>